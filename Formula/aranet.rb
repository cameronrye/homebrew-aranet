# Homebrew formula for Aranet CLI and GUI
# This file is automatically generated by the release workflow.
#
# Install with:
#   brew tap cameronrye/aranet
#   brew install aranet
#
# This installs both the CLI (aranet) and GUI (aranet-gui) binaries.
# For the native macOS app bundle, use: brew install --cask aranet-gui

class Aranet < Formula
  desc "CLI and GUI for Aranet environmental sensors (CO2, radon, temperature, humidity)"
  homepage "https://github.com/cameronrye/aranet"
  version "0.1.9"
  license "MIT"

  on_macos do
    on_arm do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-cli-aarch64-apple-darwin.tar.xz"
      sha256 "1d164335db782676bad588d08200b7855ca90d7779738a77d174d8674b7f90a9"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-gui-aarch64-apple-darwin.tar.xz"
        sha256 "0ece339bf322f053e4693baeeda3e0bd62dd6495116e1e359542fb7270bb72d7"
      end
    end
    on_intel do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-cli-x86_64-apple-darwin.tar.xz"
      sha256 "7cb9339e17084454dba9c39c3bee5f26c26f7fca544cc85bb6fba2bf57194552"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-gui-x86_64-apple-darwin.tar.xz"
        sha256 "7c0b0b9f09150b62088aaedf268cb5ee0bfc13eddd37b19d41faf0e411d58340"
      end
    end
  end

  on_linux do
    on_intel do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-cli-x86_64-unknown-linux-gnu.tar.xz"
      sha256 "f0d6bfc0c72850f6931338cf2903960338d9649b4e775ff2d607a8a2113c14a3"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.9/aranet-gui-x86_64-unknown-linux-gnu.tar.xz"
        sha256 "007613b3a722a7ff9ab82b2c416533ace93fce616b6c14ef31d5490aee82e9b7"
      end
    end
  end

  def install
    bin.install "aranet"

    # Install GUI binary from resource
    resource("gui").stage do
      bin.install "aranet-gui"
    end
  end

  def caveats
    <<~EOS
      Aranet requires Bluetooth access.

      On macOS:
        Grant Bluetooth permission when prompted, or add Terminal/iTerm
        to System Preferences > Privacy & Security > Bluetooth.

      Binaries installed:
        aranet      - Command-line interface
        aranet-gui  - Native desktop GUI

      For the macOS .app bundle with Dock icon, install the cask:
        brew install --cask cameronrye/aranet/aranet-gui

      Quick start:
        aranet scan              # Find nearby devices
        aranet read              # Read current values
        aranet-gui               # Launch the GUI
    EOS
  end

  test do
    assert_match "CLI for Aranet environmental sensors", shell_output("#{bin}/aranet --help")
    assert_match version.to_s, shell_output("#{bin}/aranet --version")
  end
end

