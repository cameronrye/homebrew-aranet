# Homebrew formula for Aranet CLI and GUI
# This file is automatically generated by the release workflow.
#
# Install with:
#   brew tap cameronrye/aranet
#   brew install aranet
#
# This installs both the CLI (aranet) and GUI (aranet-gui) binaries.
# For the native macOS app bundle, use: brew install --cask aranet-gui

class Aranet < Formula
  desc "CLI and GUI for Aranet environmental sensors (CO2, radon, temperature, humidity)"
  homepage "https://github.com/cameronrye/aranet"
  version "0.1.12"
  license "MIT"

  on_macos do
    on_arm do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-cli-aarch64-apple-darwin.tar.xz"
      sha256 "25f35428225a70c3efd1bf4b2e7bee0c256d73718dafd073eaa39b391cf0433a"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-gui-aarch64-apple-darwin.tar.xz"
        sha256 "60a6c34412c25601910edd62372e0d7821900b04c689c19e675ce675ad511ff8"
      end
    end
    on_intel do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-cli-x86_64-apple-darwin.tar.xz"
      sha256 "2ace20c7e6cbc6695a2947933b161f080ed8d798c784454db6617f4adda03711"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-gui-x86_64-apple-darwin.tar.xz"
        sha256 "4028c9388a5a246968895a577f1d23e8e935309b658e3fd9e17f73be6b10f1c0"
      end
    end
  end

  on_linux do
    on_intel do
      url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-cli-x86_64-unknown-linux-gnu.tar.xz"
      sha256 "153b56f8b648dccb39697551de4c9fd0af22a98a38a1556df74bd2c499d9f15b"

      resource "gui" do
        url "https://github.com/cameronrye/aranet/releases/download/v0.1.12/aranet-gui-x86_64-unknown-linux-gnu.tar.xz"
        sha256 "7cba7ca2378be78cfbe1fe2bf0a1384de3d3f2b5b5f893c84ba185bb8848a28d"
      end
    end
  end

  def install
    bin.install "aranet"

    # Install GUI binary from resource
    resource("gui").stage do
      bin.install "aranet-gui"
    end
  end

  def caveats
    <<~EOS
      Aranet requires Bluetooth access.

      On macOS:
        Grant Bluetooth permission when prompted, or add Terminal/iTerm
        to System Preferences > Privacy & Security > Bluetooth.

      Binaries installed:
        aranet      - Command-line interface
        aranet-gui  - Native desktop GUI

      For the macOS .app bundle with Dock icon, install the cask:
        brew install --cask cameronrye/aranet/aranet-gui

      Quick start:
        aranet scan              # Find nearby devices
        aranet read              # Read current values
        aranet-gui               # Launch the GUI
    EOS
  end

  test do
    assert_match "CLI for Aranet environmental sensors", shell_output("#{bin}/aranet --help")
    assert_match version.to_s, shell_output("#{bin}/aranet --version")
  end
end

